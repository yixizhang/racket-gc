#! /bin/bash

# parse arg to get benchmark programs to run
if [ "$1" == "" ]; then
    # remove existing data & graph
    rm basic/*.rktd 2> /dev/null
    rm basic/*.pdf 2> /dev/null
    tests=`ls basic/*.rkt`
else
    tests=`echo $1 | awk -F'.' '{print $1}'`
    find . | egrep "$tests" | egrep "\.rktd|\.pdf" | xargs rm
    tests="$tests.rkt"
fi

# copy cache model to pwd
# cp ../caches/caches-1.rkt cache.rkt 2> /dev/null

# generate data
for ratio in {3..10};
do
    for coll in batch incremental;
    do
        cp collectors/$coll-$ratio.rkt collector.rkt 2> /dev/null
        for test in $tests;
        do
            echo "$coll-$ratio -> $test"
            racket runner.rkt $coll $test $ratio
        done
    done
done

# generate graph
if [ "$1" == "" ]; then
    racket plot-graphs.rkt
else
    racket plot-graphs.rkt $tests
fi
